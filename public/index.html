# Create the main HTML file for Fleet Parts Tracker # This will be a complete
single-page application html_content = '''<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FleetParts Tracker</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #2563eb;
        --danger: #dc2626;
        --success: #16a34a;
        --warning: #f59e0b;
        --bg: #f3f4f6;
        --card: #ffffff;
        --text: #1f2937;
        --border: #e5e7eb;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
      }

      /* Header */
      .header {
        background: var(--card);
        border-bottom: 1px solid var(--border);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--primary);
      }

      .user-info {
        font-size: 0.9rem;
        color: #6b7280;
      }

      /* Container */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }

      /* Stats Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: var(--card);
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--primary);
      }

      .stat-card.warning {
        border-left-color: var(--danger);
      }

      .stat-card.success {
        border-left-color: var(--success);
      }

      .stat-card.info {
        border-left-color: var(--warning);
      }

      .stat-label {
        font-size: 0.875rem;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin-top: 0.5rem;
      }

      .stat-value.danger {
        color: var(--danger);
      }

      /* Action Bar */
      .action-bar {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s;
        font-weight: 500;
      }

      .btn-primary {
        background: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background: #1d4ed8;
        transform: translateY(-1px);
        box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
      }

      .btn-secondary {
        background: var(--card);
        color: var(--text);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--bg);
      }

      .btn-danger {
        background: var(--danger);
        color: white;
      }

      .btn-success {
        background: var(--success);
        color: white;
      }

      .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }

      /* Tabs */
      .tabs {
        display: flex;
        border-bottom: 2px solid var(--border);
        margin-bottom: 2rem;
        background: var(--card);
        padding: 0 2rem;
        border-radius: 8px 8px 0 0;
      }

      .tab {
        padding: 1rem 2rem;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        margin-bottom: -2px;
        font-weight: 500;
        color: #6b7280;
        transition: all 0.2s;
      }

      .tab:hover {
        color: var(--primary);
      }

      .tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
      }

      /* Search */
      .search-bar {
        margin-bottom: 1.5rem;
      }

      .search-input {
        width: 100%;
        max-width: 400px;
        padding: 0.75rem 1rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 1rem;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      /* Tables */
      .table-container {
        background: var(--card);
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background: var(--bg);
        padding: 1rem;
        text-align: left;
        font-weight: 600;
        color: #6b7280;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      td {
        padding: 1rem;
        border-bottom: 1px solid var(--border);
      }

      tr:hover {
        background: var(--bg);
      }

      .low-stock {
        background: #fef2f2 !important;
      }

      .badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .badge-danger {
        background: #fecaca;
        color: var(--danger);
      }

      .badge-success {
        background: #bbf7d0;
        color: var(--success);
      }

      /* Modals */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        animation: fadeIn 0.2s;
      }

      .modal-overlay.active {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .modal {
        background: var(--card);
        border-radius: 8px;
        width: 100%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        animation: slideUp 0.3s;
      }

      .modal-header {
        padding: 1.5rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-title {
        font-size: 1.25rem;
        font-weight: bold;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #6b7280;
        padding: 0.5rem;
        line-height: 1;
      }

      .modal-close:hover {
        color: var(--text);
      }

      .modal-body {
        padding: 1.5rem;
      }

      .modal-footer {
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
      }

      /* Forms */
      .form-group {
        margin-bottom: 1rem;
      }

      label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        font-size: 0.875rem;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        font-size: 1rem;
        font-family: inherit;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .checkbox-group input {
        width: auto;
      }

      /* Repair Cards */
      .repair-card {
        background: var(--card);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-left: 4px solid var(--primary);
      }

      .repair-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
      }

      .repair-date {
        font-weight: bold;
        color: var(--primary);
      }

      .repair-truck {
        font-size: 1.1rem;
        font-weight: 600;
      }

      .repair-issue {
        margin: 0.5rem 0;
        color: #4b5563;
      }

      .repair-parts {
        background: var(--bg);
        padding: 0.75rem;
        border-radius: 6px;
        margin: 0.5rem 0;
        font-size: 0.9rem;
      }

      .repair-photos {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .repair-photo {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
        cursor: pointer;
        border: 2px solid var(--border);
      }

      .repair-photo:hover {
        border-color: var(--primary);
      }

      /* Fleet Grid */
      .fleet-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
      }

      .fleet-card {
        background: var(--card);
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-top: 4px solid var(--primary);
      }

      .fleet-card.trailer {
        border-top-color: var(--warning);
      }

      .fleet-id {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 600;
        text-transform: uppercase;
      }

      .fleet-name {
        font-size: 1.25rem;
        font-weight: bold;
        margin: 0.5rem 0;
      }

      .fleet-type {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        background: var(--bg);
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .repair-history-btn {
        margin-top: 1rem;
        width: 100%;
      }

      /* Photo Upload */
      .photo-upload {
        border: 2px dashed var(--border);
        border-radius: 6px;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
      }

      .photo-upload:hover {
        border-color: var(--primary);
        background: rgba(37, 99, 235, 0.05);
      }

      .photo-preview {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
        flex-wrap: wrap;
      }

      .photo-preview img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 4px;
        border: 2px solid var(--border);
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 3rem;
        color: #6b7280;
      }

      .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .tabs {
          padding: 0;
        }

        .tab {
          padding: 1rem;
          font-size: 0.875rem;
        }

        table {
          font-size: 0.875rem;
        }

        th,
        td {
          padding: 0.75rem 0.5rem;
        }

        .action-bar {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }

      /* Print styles */
      @media print {
        .header,
        .action-bar,
        .tabs,
        .btn {
          display: none;
        }

        .tab-content {
          display: block !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo">üîß FleetParts Tracker</div>
      <div class="user-info">Local Mode | <span id="current-date"></span></div>
    </header>

    <div class="container">
      <!-- Stats Dashboard -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Parts</div>
          <div class="stat-value" id="stat-total-parts">0</div>
        </div>
        <div class="stat-card warning">
          <div class="stat-label">Low Stock</div>
          <div class="stat-value danger" id="stat-low-stock">0</div>
        </div>
        <div class="stat-card success">
          <div class="stat-label">Fleet Size</div>
          <div class="stat-value" id="stat-fleet-size">0</div>
        </div>
        <div class="stat-card info">
          <div class="stat-label">This Month</div>
          <div class="stat-value" id="stat-month-cost">$0</div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-bar">
        <button class="btn btn-primary" onclick="openModal('part-modal')">
          <span>+</span> Add Part
        </button>
        <button class="btn btn-success" onclick="openModal('repair-modal')">
          <span>üîß</span> Log Repair
        </button>
        <button class="btn btn-secondary" onclick="openModal('truck-modal')">
          <span>üöõ</span> Add Vehicle
        </button>
        <button class="btn btn-secondary" onclick="exportData()">
          <span>üíæ</span> Export Data
        </button>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <div class="tab active" onclick="switchTab('parts')">
          Parts Inventory
        </div>
        <div class="tab" onclick="switchTab('repairs')">Repair History</div>
        <div class="tab" onclick="switchTab('fleet')">Fleet</div>
      </div>

      <!-- Search -->
      <div class="search-bar">
        <input
          type="text"
          class="search-input"
          id="search-input"
          placeholder="Search parts, repairs, or vehicles..."
          onkeyup="handleSearch()"
        />
      </div>

      <!-- Tab Contents -->
      <div id="parts-tab" class="tab-content">
        <div class="table-container">
          <table id="parts-table">
            <thead>
              <tr>
                <th>Part #</th>
                <th>Description</th>
                <th>Category</th>
                <th>Stock</th>
                <th>Location</th>
                <th>Cost</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="parts-tbody">
              <!-- Dynamic content -->
            </tbody>
          </table>
        </div>
      </div>

      <div id="repairs-tab" class="tab-content" style="display: none">
        <div id="repairs-list">
          <!-- Dynamic content -->
        </div>
      </div>

      <div id="fleet-tab" class="tab-content" style="display: none">
        <div class="fleet-grid" id="fleet-grid">
          <!-- Dynamic content -->
        </div>
      </div>
    </div>

    <!-- Add Part Modal -->
    <div id="part-modal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Add New Part</h2>
          <button class="modal-close" onclick="closeModal('part-modal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="part-form">
            <div class="form-row">
              <div class="form-group">
                <label>Part Number *</label>
                <input type="text" name="partNumber" required />
              </div>
              <div class="form-group">
                <label>Category *</label>
                <select name="category" required>
                  <option value="">Select Category</option>
                  <option value="Engine">Engine</option>
                  <option value="Transmission">Transmission</option>
                  <option value="Brakes">Brakes</option>
                  <option value="Electrical">Electrical</option>
                  <option value="Body">Body</option>
                  <option value="Tires">Tires</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Description *</label>
              <input type="text" name="description" required />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Quantity *</label>
                <input type="number" name="quantity" min="0" required />
              </div>
              <div class="form-group">
                <label>Minimum Stock *</label>
                <input type="number" name="minStock" min="1" required />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Location</label>
                <input
                  type="text"
                  name="location"
                  placeholder="e.g., Shelf A-1"
                />
              </div>
              <div class="form-group">
                <label>Unit Cost ($)</label>
                <input type="number" name="cost" step="0.01" min="0" />
              </div>
            </div>
            <div class="form-group">
              <label>Supplier</label>
              <input type="text" name="supplier" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeModal('part-modal')">
            Cancel
          </button>
          <button class="btn btn-primary" onclick="savePart()">
            Save Part
          </button>
        </div>
      </div>
    </div>

    <!-- Log Repair Modal -->
    <div id="repair-modal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Log Repair</h2>
          <button class="modal-close" onclick="closeModal('repair-modal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="repair-form">
            <div class="form-row">
              <div class="form-group">
                <label>Date *</label>
                <input type="date" name="date" required />
              </div>
              <div class="form-group">
                <label>Vehicle *</label>
                <select name="truckId" id="repair-truck-select" required>
                  <option value="">Select Vehicle</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Issue Description *</label>
              <textarea name="issue" rows="3" required></textarea>
            </div>
            <div class="form-group">
              <label>Parts Used</label>
              <div id="parts-used-container">
                <div
                  class="parts-used-row"
                  style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem"
                >
                  <select class="part-select" style="flex: 2">
                    <option value="">Select Part</option>
                  </select>
                  <input
                    type="number"
                    class="part-qty"
                    placeholder="Qty"
                    min="1"
                    value="1"
                    style="flex: 1"
                  />
                  <button
                    type="button"
                    class="btn btn-danger btn-sm"
                    onclick="this.parentElement.remove()"
                  >
                    √ó
                  </button>
                </div>
              </div>
              <button
                type="button"
                class="btn btn-secondary btn-sm"
                onclick="addPartUsedRow()"
                style="margin-top: 0.5rem"
              >
                + Add Part
              </button>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Labor Hours</label>
                <input type="number" name="laborHours" step="0.5" min="0" />
              </div>
              <div class="form-group">
                <label>Mechanic</label>
                <input type="text" name="mechanic" />
              </div>
            </div>
            <div class="form-group">
              <label>Notes</label>
              <textarea name="notes" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label>Photos</label>
              <div
                class="photo-upload"
                onclick="document.getElementById('repair-photos').click()"
              >
                <div>üì∑ Click to upload photos (Max 3)</div>
                <div
                  style="
                    font-size: 0.875rem;
                    color: #6b7280;
                    margin-top: 0.5rem;
                  "
                >
                  Max 500KB each
                </div>
              </div>
              <input
                type="file"
                id="repair-photos"
                multiple
                accept="image/*"
                style="display: none"
                onchange="handlePhotoUpload(this)"
              />
              <div class="photo-preview" id="photo-preview"></div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            class="btn btn-secondary"
            onclick="closeModal('repair-modal')"
          >
            Cancel
          </button>
          <button class="btn btn-primary" onclick="saveRepair()">
            Log Repair
          </button>
        </div>
      </div>
    </div>

    <!-- Add Truck Modal -->
    <div id="truck-modal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Add Vehicle</h2>
          <button class="modal-close" onclick="closeModal('truck-modal')">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <form id="truck-form">
            <div class="form-row">
              <div class="form-group">
                <label>Unit ID *</label>
                <input
                  type="text"
                  name="id"
                  placeholder="e.g., TRK-001"
                  required
                />
              </div>
              <div class="form-group">
                <label>Type *</label>
                <select name="type" required>
                  <option value="truck">Truck</option>
                  <option value="trailer">Trailer</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>Name/Description *</label>
              <input
                type="text"
                name="name"
                placeholder="e.g., 2019 Freightliner Cascadia"
                required
              />
            </div>
            <div class="form-group">
              <label>VIN</label>
              <input type="text" name="vin" />
            </div>
            <div class="form-group">
              <label>Notes</label>
              <textarea name="notes" rows="2"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeModal('truck-modal')">
            Cancel
          </button>
          <button class="btn btn-primary" onclick="saveTruck()">
            Add Vehicle
          </button>
        </div>
      </div>
    </div>

    <!-- Image Viewer Modal -->
    <div
      id="image-modal"
      class="modal-overlay"
      onclick="closeModal('image-modal')"
    >
      <div
        class="modal"
        style="max-width: 90vw"
        onclick="event.stopPropagation()"
      >
        <div class="modal-body" style="padding: 0">
          <img
            id="enlarged-image"
            src=""
            style="width: 100%; height: auto; display: block"
          />
        </div>
      </div>
    </div>

    <script>
      // Data Store
      let data = {
        parts: [],
        repairs: [],
        trucks: [],
      };

      // Temporary storage for uploaded photos
      let tempPhotos = [];

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        loadData();
        updateStats();
        renderParts();
        renderRepairs();
        renderFleet();
        setupDate();
        populateTruckSelect();
        populatePartSelects();
      });

      // Date setup
      function setupDate() {
        document.getElementById("current-date").textContent =
          new Date().toLocaleDateString();
        document.querySelector('input[name="date"]').valueAsDate = new Date();
      }

      // LocalStorage Operations
      function saveToStorage() {
        localStorage.setItem("fleet_parts_v1", JSON.stringify(data.parts));
        localStorage.setItem("fleet_repairs_v1", JSON.stringify(data.repairs));
        localStorage.setItem("fleet_trucks_v1", JSON.stringify(data.trucks));
      }

      function loadData() {
        const parts = localStorage.getItem("fleet_parts_v1");
        const repairs = localStorage.getItem("fleet_repairs_v1");
        const trucks = localStorage.getItem("fleet_trucks_v1");

        if (parts) data.parts = JSON.parse(parts);
        if (repairs) data.repairs = JSON.parse(repairs);
        if (trucks) data.trucks = JSON.parse(trucks);

        // Load sample data if empty
        if (data.parts.length === 0 && data.trucks.length === 0) {
          loadSampleData();
        }
      }

      function loadSampleData() {
        data.parts = [
          {
            id: "1",
            partNumber: "BP-001",
            description: "Brake Pad Set",
            category: "Brakes",
            quantity: 8,
            minStock: 5,
            location: "A-1",
            cost: 45,
            supplier: "FleetPride",
          },
          {
            id: "2",
            partNumber: "OF-002",
            description: "Oil Filter",
            category: "Engine",
            quantity: 2,
            minStock: 10,
            location: "B-2",
            cost: 12,
            supplier: "FleetPride",
          },
          {
            id: "3",
            partNumber: "AF-003",
            description: "Air Filter",
            category: "Engine",
            quantity: 5,
            minStock: 3,
            location: "B-3",
            cost: 25,
            supplier: "NAPA",
          },
          {
            id: "4",
            partNumber: "TB-004",
            description: "Tie Rod End",
            category: "Steering",
            quantity: 4,
            minStock: 2,
            location: "C-1",
            cost: 35,
            supplier: "FleetPride",
          },
        ];

        data.trucks = [
          {
            id: "TRK-001",
            name: "2019 Freightliner Cascadia",
            type: "truck",
            vin: "1FUJGHDV0KLXXXXXX",
            notes: "Main highway unit",
          },
          {
            id: "TRK-002",
            name: "2020 Peterbilt 579",
            type: "truck",
            vin: "1XPBDP9X2LDXXXXXX",
            notes: "Secondary unit",
          },
          {
            id: "TRL-001",
            name: "2018 Utility Reefer",
            type: "trailer",
            vin: "1UYVS2539JXXXXXXX",
            notes: "Refrigerated trailer",
          },
          {
            id: "TRL-002",
            name: "2020 Great Dane Dry Van",
            type: "trailer",
            vin: "1GRAA0629LXXXXXXX",
            notes: "Dry van",
          },
        ];

        data.repairs = [
          {
            id: "1",
            date: "2024-02-20",
            truckId: "TRK-001",
            issue: "Oil change and routine maintenance",
            partsUsed: [{ partId: "2", partNumber: "OF-002", quantity: 1 }],
            laborHours: 1,
            mechanic: "Mike",
            notes: "Standard maintenance",
            photos: [],
          },
        ];

        saveToStorage();
      }

      // Stats
      function updateStats() {
        document.getElementById("stat-total-parts").textContent =
          data.parts.length;

        const lowStock = data.parts.filter(
          (p) => p.quantity <= p.minStock,
        ).length;
        document.getElementById("stat-low-stock").textContent = lowStock;

        document.getElementById("stat-fleet-size").textContent =
          data.trucks.length;

        // Calculate this month's costs
        const now = new Date();
        const currentMonth = now.toISOString().slice(0, 7); // YYYY-MM

        const monthCost = data.repairs
          .filter((r) => r.date.startsWith(currentMonth))
          .reduce((sum, r) => {
            const partsCost = r.partsUsed.reduce((pSum, p) => {
              const part = data.parts.find((pt) => pt.id === p.partId);
              return pSum + (part ? part.cost : 0) * p.quantity;
            }, 0);
            return sum + partsCost;
          }, 0);

        document.getElementById("stat-month-cost").textContent =
          "$" + monthCost.toLocaleString();
      }

      // Tab Switching
      function switchTab(tab) {
        // Hide all tabs
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => (el.style.display = "none"));
        document
          .querySelectorAll(".tab")
          .forEach((el) => el.classList.remove("active"));

        // Show selected
        document.getElementById(tab + "-tab").style.display = "block";
        event.target.classList.add("active");

        // Refresh data
        if (tab === "parts") renderParts();
        if (tab === "repairs") renderRepairs();
        if (tab === "fleet") renderFleet();
      }

      // Modal Functions
      function openModal(modalId) {
        document.getElementById(modalId).classList.add("active");
        if (modalId === "repair-modal") {
          populateTruckSelect();
          populatePartSelects();
          tempPhotos = [];
          document.getElementById("photo-preview").innerHTML = "";
        }
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("active");
        // Reset forms
        if (modalId !== "image-modal") {
          document.querySelector(`#${modalId} form`).reset();
        }
      }

      // Parts Management
      function renderParts() {
        const tbody = document.getElementById("parts-tbody");
        const searchTerm = document
          .getElementById("search-input")
          .value.toLowerCase();

        let filtered = data.parts;
        if (
          searchTerm &&
          document.querySelector(".tab.active").textContent.includes("Parts")
        ) {
          filtered = data.parts.filter(
            (p) =>
              p.partNumber.toLowerCase().includes(searchTerm) ||
              p.description.toLowerCase().includes(searchTerm) ||
              p.category.toLowerCase().includes(searchTerm),
          );
        }

        if (filtered.length === 0) {
          tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <div>No parts found. Add your first part to get started.</div>
                        </td>
                    </tr>
                `;
          return;
        }

        tbody.innerHTML = filtered
          .map((part) => {
            const isLow = part.quantity <= part.minStock;
            return `
                    <tr class="${isLow ? "low-stock" : ""}">
                        <td><strong>${part.partNumber}</strong></td>
                        <td>${part.description}</td>
                        <td>${part.category}</td>
                        <td>
                            ${part.quantity} 
                            ${isLow ? '<span class="badge badge-danger">LOW</span>' : '<span class="badge badge-success">OK</span>'}
                        </td>
                        <td>${part.location || "-"}</td>
                        <td>$${part.cost || 0}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="editPart('${part.id}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deletePart('${part.id}')">Delete</button>
                        </td>
                    </tr>
                `;
          })
          .join("");
      }

      function savePart() {
        const form = document.getElementById("part-form");
        const formData = new FormData(form);

        const part = {
          id: Date.now().toString(),
          partNumber: formData.get("partNumber"),
          description: formData.get("description"),
          category: formData.get("category"),
          quantity: parseInt(formData.get("quantity")),
          minStock: parseInt(formData.get("minStock")),
          location: formData.get("location"),
          cost: parseFloat(formData.get("cost")) || 0,
          supplier: formData.get("supplier"),
        };

        data.parts.push(part);
        saveToStorage();
        renderParts();
        updateStats();
        closeModal("part-modal");
      }

      function deletePart(id) {
        if (confirm("Are you sure you want to delete this part?")) {
          data.parts = data.parts.filter((p) => p.id !== id);
          saveToStorage();
          renderParts();
          updateStats();
        }
      }

      function editPart(id) {
        // For simplicity, just delete and re-add in MVP
        // In full version, would populate modal with existing data
        alert("Edit functionality: Delete and re-add with changes for now");
      }

      // Repair Management
      function renderRepairs() {
        const container = document.getElementById("repairs-list");
        const searchTerm = document
          .getElementById("search-input")
          .value.toLowerCase();

        let filtered = data.repairs.sort(
          (a, b) => new Date(b.date) - new Date(a.date),
        );

        if (
          searchTerm &&
          document.querySelector(".tab.active").textContent.includes("Repair")
        ) {
          filtered = filtered.filter((r) => {
            const truck = data.trucks.find((t) => t.id === r.truckId);
            return (
              r.issue.toLowerCase().includes(searchTerm) ||
              (truck && truck.name.toLowerCase().includes(searchTerm))
            );
          });
        }

        if (filtered.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîß</div>
                        <div>No repairs logged yet.</div>
                    </div>
                `;
          return;
        }

        container.innerHTML = filtered
          .map((repair) => {
            const truck = data.trucks.find((t) => t.id === repair.truckId);
            const partsList =
              repair.partsUsed
                .map((p) => {
                  const part = data.parts.find((pt) => pt.id === p.partId);
                  return `${p.quantity}x ${part ? part.partNumber : "Unknown"}`;
                })
                .join(", ") || "No parts used";

            return `
                    <div class="repair-card">
                        <div class="repair-header">
                            <div>
                                <div class="repair-date">${new Date(repair.date).toLocaleDateString()}</div>
                                <div class="repair-truck">${truck ? truck.name : "Unknown Vehicle"} (${repair.truckId})</div>
                            </div>
                            <button class="btn btn-sm btn-danger" onclick="deleteRepair('${repair.id}')">Delete</button>
                        </div>
                        <div class="repair-issue"><strong>Issue:</strong> ${repair.issue}</div>
                        <div class="repair-parts"><strong>Parts Used:</strong> ${partsList}</div>
                        ${repair.laborHours ? `<div><strong>Labor:</strong> ${repair.laborHours} hours by ${repair.mechanic || "Unknown"}</div>` : ""}
                        ${repair.notes ? `<div style="margin-top: 0.5rem; color: #6B7280;">${repair.notes}</div>` : ""}
                        ${
                          repair.photos.length > 0
                            ? `
                            <div class="repair-photos">
                                ${repair.photos
                                  .map(
                                    (photo) => `
                                    <img src="${photo}" class="repair-photo" onclick="viewImage('${photo}')">
                                `,
                                  )
                                  .join("")}
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
          })
          .join("");
      }

      function populateTruckSelect() {
        const select = document.getElementById("repair-truck-select");
        select.innerHTML =
          '<option value="">Select Vehicle</option>' +
          data.trucks
            .map((t) => `<option value="${t.id}">${t.id} - ${t.name}</option>`)
            .join("");
      }

      function populatePartSelects() {
        document.querySelectorAll(".part-select").forEach((select) => {
          select.innerHTML =
            '<option value="">Select Part</option>' +
            data.parts
              .map(
                (p) =>
                  `<option value="${p.id}">${p.partNumber} - ${p.description} (Stock: ${p.quantity})</option>`,
              )
              .join("");
        });
      }

      function addPartUsedRow() {
        const container = document.getElementById("parts-used-container");
        const div = document.createElement("div");
        div.className = "parts-used-row";
        div.style.cssText =
          "display: flex; gap: 0.5rem; margin-bottom: 0.5rem;";
        div.innerHTML = `
                <select class="part-select" style="flex: 2;">
                    <option value="">Select Part</option>
                    ${data.parts.map((p) => `<option value="${p.id}">${p.partNumber} - ${p.description}</option>`).join("")}
                </select>
                <input type="number" class="part-qty" placeholder="Qty" min="1" value="1" style="flex: 1;">
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">√ó</button>
            `;
        container.appendChild(div);
      }

      function handlePhotoUpload(input) {
        const files = Array.from(input.files);
        if (tempPhotos.length + files.length > 3) {
          alert("Maximum 3 photos allowed");
          return;
        }

        files.forEach((file) => {
          if (file.size > 500 * 1024) {
            alert("Photo must be less than 500KB");
            return;
          }

          const reader = new FileReader();
          reader.onload = function (e) {
            tempPhotos.push(e.target.result);
            updatePhotoPreview();
          };
          reader.readAsDataURL(file);
        });
      }

      function updatePhotoPreview() {
        const preview = document.getElementById("photo-preview");
        preview.innerHTML = tempPhotos
          .map(
            (photo, idx) => `
                <div style="position: relative;">
                    <img src="${photo}">
                    <button type="button" onclick="removePhoto(${idx})" style="position: absolute; top: -8px; right: -8px; background: var(--danger); color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-size: 12px;">√ó</button>
                </div>
            `,
          )
          .join("");
      }

      function removePhoto(index) {
        tempPhotos.splice(index, 1);
        updatePhotoPreview();
      }

      function viewImage(src) {
        document.getElementById("enlarged-image").src = src;
        openModal("image-modal");
      }

      function saveRepair() {
        const form = document.getElementById("repair-form");
        const formData = new FormData(form);

        // Collect parts used
        const partsUsed = [];
        document.querySelectorAll(".parts-used-row").forEach((row) => {
          const partId = row.querySelector(".part-select").value;
          const qty = parseInt(row.querySelector(".part-qty").value);
          if (partId && qty) {
            const part = data.parts.find((p) => p.id === partId);
            partsUsed.push({
              partId: partId,
              partNumber: part ? part.partNumber : "Unknown",
              quantity: qty,
            });

            // Deduct from inventory
            if (part) {
              part.quantity -= qty;
            }
          }
        });

        const repair = {
          id: Date.now().toString(),
          date: formData.get("date"),
          truckId: formData.get("truckId"),
          issue: formData.get("issue"),
          partsUsed: partsUsed,
          laborHours: parseFloat(formData.get("laborHours")) || 0,
          mechanic: formData.get("mechanic"),
          notes: formData.get("notes"),
          photos: tempPhotos,
        };

        data.repairs.push(repair);
        saveToStorage();
        renderRepairs();
        renderParts(); // Update stock levels
        updateStats();
        closeModal("repair-modal");
        tempPhotos = [];
      }

      function deleteRepair(id) {
        if (confirm("Delete this repair record?")) {
          data.repairs = data.repairs.filter((r) => r.id !== id);
          saveToStorage();
          renderRepairs();
          updateStats();
        }
      }

      // Fleet Management
      function renderFleet() {
        const grid = document.getElementById("fleet-grid");
        const searchTerm = document
          .getElementById("search-input")
          .value.toLowerCase();

        let filtered = data.trucks;
        if (
          searchTerm &&
          document.querySelector(".tab.active").textContent.includes("Fleet")
        ) {
          filtered = data.trucks.filter(
            (t) =>
              t.id.toLowerCase().includes(searchTerm) ||
              t.name.toLowerCase().includes(searchTerm),
          );
        }

        if (filtered.length === 0) {
          grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üöõ</div>
                        <div>No vehicles added yet.</div>
                    </div>
                `;
          return;
        }

        grid.innerHTML = filtered
          .map((truck) => {
            const repairCount = data.repairs.filter(
              (r) => r.truckId === truck.id,
            ).length;
            return `
                    <div class="fleet-card ${truck.type}">
                        <div class="fleet-id">${truck.id}</div>
                        <div class="fleet-name">${truck.name}</div>
                        <span class="fleet-type">${truck.type}</span>
                        ${truck.vin ? `<div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6B7280;">VIN: ${truck.vin}</div>` : ""}
                        ${truck.notes ? `<div style="margin-top: 0.5rem; font-size: 0.875rem; color: #6B7280;">${truck.notes}</div>` : ""}
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                            <div style="font-size: 0.875rem; color: #6B7280;">
                                üîß ${repairCount} repair${repairCount !== 1 ? "s" : ""} logged
                            </div>
                        </div>
                        <button class="btn btn-secondary btn-sm repair-history-btn" onclick="viewTruckHistory('${truck.id}')">View History</button>
                    </div>
                `;
          })
          .join("");
      }

      function saveTruck() {
        const form = document.getElementById("truck-form");
        const formData = new FormData(form);

        const truck = {
          id: formData.get("id").toUpperCase(),
          name: formData.get("name"),
          type: formData.get("type"),
          vin: formData.get("vin"),
          notes: formData.get("notes"),
        };

        // Check for duplicate ID
        if (data.trucks.find((t) => t.id === truck.id)) {
          alert("Vehicle ID already exists!");
          return;
        }

        data.trucks.push(truck);
        saveToStorage();
        renderFleet();
        updateStats();
        closeModal("truck-modal");
      }

      function viewTruckHistory(truckId) {
        // Switch to repairs tab and filter
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => (el.style.display = "none"));
        document
          .querySelectorAll(".tab")
          .forEach((el) => el.classList.remove("active"));

        document.getElementById("repairs-tab").style.display = "block";
        document.querySelectorAll(".tab")[1].classList.add("active");

        document.getElementById("search-input").value = truckId;
        handleSearch();
      }

      // Search
      function handleSearch() {
        const activeTab = document.querySelector(".tab.active").textContent;
        if (activeTab.includes("Parts")) renderParts();
        else if (activeTab.includes("Repair")) renderRepairs();
        else if (activeTab.includes("Fleet")) renderFleet();
      }

      // Export Data
      function exportData() {
        const exportObj = {
          parts: data.parts,
          repairs: data.repairs,
          trucks: data.trucks,
          exportDate: new Date().toISOString(),
        };

        const blob = new Blob([JSON.stringify(exportObj, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `fleet-backup-${new Date().toISOString().split("T")[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      // Close modals on escape key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          document.querySelectorAll(".modal-overlay").forEach((modal) => {
            modal.classList.remove("active");
          });
        }
      });
    </script>
  </body>
</html>
''' # Save the HTML file with open('/mnt/kimi/output/fleet-parts-tracker.html',
'w', encoding='utf-8') as f: f.write(html_content) print("‚úÖ Fleet Parts Tracker
web app created successfully!") print("üìÅ Location:
/mnt/kimi/output/fleet-parts-tracker.html") print("\nüìã Features included:")
print(" ‚Ä¢ Dashboard with stats (Total Parts, Low Stock, Fleet Size, Monthly
Costs)") print(" ‚Ä¢ Parts Inventory with low stock alerts (red highlighting)")
print(" ‚Ä¢ Repair logging with photo upload (Base64)") print(" ‚Ä¢ Fleet management
(Trucks & Trailers)") print(" ‚Ä¢ LocalStorage persistence (data saves
automatically)") print(" ‚Ä¢ Search functionality across all tabs") print(" ‚Ä¢
Export data to JSON backup") print(" ‚Ä¢ Fully responsive design
(mobile-friendly)") print(" ‚Ä¢ Sample data pre-loaded for testing")
